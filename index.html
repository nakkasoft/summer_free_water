<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ì„œìš¸ì‹œ ì—¬ë¦„ì²  ë¬´ë£Œ ìƒìˆ˜ ì œê³µ ìœ„ì¹˜</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ì„œìš¸ì‹œ ê° êµ¬ì—                    this.updateStats();
                    this.showLoading(false);

                } catch (error) {ì—¬ë¦„ì²  ë¬´ë£Œ ìƒìˆ˜ ì œê³µ ìœ„ì¹˜ë¥¼ ì§€ë„ì—ì„œ í™•ì¸í•˜ì„¸ìš”.">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- ë¡œë”© í™”ë©´ -->
    <div id="loading">
        <div>ë°ì´í„°ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘...</div>
        <div id="loadingStatus" style="font-size: 12px; margin-top: 10px; color: #666;"></div>
    </div>

    <!-- ë””ë²„ê·¸ ì •ë³´ (ê°œë°œìš©) -->
    <div id="debug-info" style="position: fixed; bottom: 10px; right: 10px; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 5px; font-size: 12px; max-width: 300px; display: none;">
        <div id="debug-content"></div>
        <button onclick="document.getElementById('debug-info').style.display='none'" style="margin-top: 5px; padding: 2px 5px;">ë‹«ê¸°</button>
    </div>

    <!-- ì§€ë„ ì»¨í…Œì´ë„ˆ -->
    <div id="map"></div>
    
    <!-- ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
    <div id="controls">
        <h3>ğŸš° ìƒìˆ˜ ì œê³µ ìœ„ì¹˜ ì°¾ê¸°</h3>
        
        <div class="control-group">
            <label for="districtFilter">êµ¬ë³„ ê²€ìƒ‰</label>
            <select id="districtFilter">
                <option value="">ì „ì²´ êµ¬</option>
                <option value="ì¤‘êµ¬">ì¤‘êµ¬</option>
                <option value="ì¤‘ë‘êµ¬">ì¤‘ë‘êµ¬</option>
                <option value="ì„±ë¶êµ¬">ì„±ë¶êµ¬</option>
                <option value="ë„ë´‰êµ¬">ë„ë´‰êµ¬</option>
                <option value="ë…¸ì›êµ¬">ë…¸ì›êµ¬</option>
                <option value="ë§ˆí¬êµ¬">ë§ˆí¬êµ¬</option>
                <option value="ê°•ë¶êµ¬">ê°•ë¶êµ¬</option>
            </select>
        </div>
        
        <div class="control-group">
            <label for="searchInput">ì¥ì†Œëª…/ì£¼ì†Œ ê²€ìƒ‰</label>
            <div class="control-row">
                <input type="text" id="searchInput" placeholder="ì˜ˆ: ì‹œì²­, ê³µì›, ë„ì„œê´€">
                <button id="searchBtn">ê²€ìƒ‰</button>
            </div>
        </div>
        
        <div class="control-group">
            <div class="control-row">
                <button id="nearbyBtn">ğŸ“ ë‚´ ì£¼ë³€</button>
                <button id="showAllBtn">ğŸ—ºï¸ ì „ì²´ ë³´ê¸°</button>
            </div>
        </div>
    </div>

    <!-- í†µê³„ ì •ë³´ -->
    <div id="stats" style="display: none;">
        <span id="totalCount">ì „ì²´: 0ê°œ</span>
        <span id="operatingCount">ìš´ì˜ì¤‘: 0ê°œ</span>
    </div>

    <!-- Supabase JavaScript SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.4/dist/umd/supabase.min.js"></script>
    
    <!-- ì „ì—­ Supabase ì‹±ê¸€í†¤ í´ë¼ì´ì–¸íŠ¸ -->
    <script src="js/utils/supabase-global.js"></script>
    
    <!-- ë¡œì»¬ ê°œë°œìš© ì„ì‹œ í™˜ê²½ë³€ìˆ˜ ì„¤ì • (ë¹Œë“œ ë„êµ¬ ì—†ì´ ì§ì ‘ HTML ì—´ ë•Œ) -->
    <script>
        // ë¹Œë“œ ë„êµ¬(Vite ë“±) ì—†ì´ ì§ì ‘ HTMLì„ ì—´ ë•Œë§Œ ì‚¬ìš©
        // window.ENVê°€ ì—†ìœ¼ë©´ ì„ì‹œ ì„¤ì •
        if (!window.ENV) {
            // Vercel í™˜ê²½ì—ì„œëŠ” í™˜ê²½ë³€ìˆ˜ê°€ ë¹Œë“œ ì‹œ ì£¼ì…ë˜ë¯€ë¡œ ì—¬ê¸°ì„œ í™•ì¸
            const isVercel = window.location.hostname.includes('vercel.app') || 
                           window.location.hostname.includes('vercel.com');
            
            if (isVercel) {
                // Vercel í™˜ê²½: í™˜ê²½ë³€ìˆ˜ëŠ” ë¹Œë“œ ì‹œ ì£¼ì…ë˜ë¯€ë¡œ ê¸°ë³¸ê°’ë§Œ ì„¤ì •
                window.ENV = {
                    KAKAO_API_KEY: '932066d1403575d3521925f322ec1d8b',
                    DATABASE_TYPE: 'local', // Vercelì—ì„œë„ ë¡œì»¬ ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©
                    SUPABASE_URL: 'https://gmmnverhexhwboedtlai.supabase.co',
                    SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdtbW52ZXJoZXhod2JvZWR0bGFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2NTYyMDgsImV4cCI6MjA3MTIzMjIwOH0.TecIAycrP1rXJYVuDR7lz9fA0nqUWtz4QGqAPOmSdTg'
                };
                console.log('ğŸŒ Vercel í™˜ê²½: í™˜ê²½ë³€ìˆ˜ ì„¤ì •ë¨');
            } else {
                // ë¡œì»¬ ê°œë°œ í™˜ê²½
                window.ENV = {
                    KAKAO_API_KEY: '932066d1403575d3521925f322ec1d8b',
                    SUPABASE_URL: 'https://gmmnverhexhwboedtlai.supabase.co',
                    SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdtbW52ZXJoZXhod2JvZWR0bGFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2NTYyMDgsImV4cCI6MjA3MTIzMjIwOH0.TecIAycrP1rXJYVuDR7lz9fA0nqUWtz4QGqAPOmSdTg',
                    DATABASE_TYPE: 'local'  // ë¡œì»¬ì—ì„œë„ local ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©
                };
                console.log('ğŸ”§ ë¡œì»¬ ê°œë°œëª¨ë“œ: ì„ì‹œ í™˜ê²½ë³€ìˆ˜ ì„¤ì •ë¨');
            }
        }
        
        // ë””ë²„ê·¸ í•¨ìˆ˜ë“¤
        window.debugApp = function() {
            console.log('ğŸ” ì•± ìƒíƒœ í™•ì¸:');
            console.log('- Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬:', typeof supabase !== 'undefined' ? 'âœ… ë¡œë“œë¨' : 'âŒ ì—†ìŒ');
            console.log('- í™˜ê²½ë³€ìˆ˜:', window.ENV);
            console.log('- Kakao Maps:', typeof kakao !== 'undefined' ? 'âœ… ë¡œë“œë¨' : 'âŒ ì—†ìŒ');
        };
        
        window.testWaterStations = async function() {
            try {
                console.log('ğŸ” ë¬¼ ì œê³µ ìœ„ì¹˜ ë°ì´í„° í…ŒìŠ¤íŠ¸:');
                const response = await fetch('/data/water_stations.json');
                const data = await response.json();
                console.log('âœ… ë°ì´í„° ë¡œë“œ ì„±ê³µ:', data.length + 'ê°œ');
                console.log('ğŸ“ ì²« ë²ˆì§¸ ìœ„ì¹˜:', data[0]);
                return data;
            } catch (error) {
                console.error('âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                return null;
            }
        };
        
        window.testAppInitialization = async function() {
            console.log('ï¿½ ì•± ì´ˆê¸°í™” ë‹¨ê³„ë³„ í…ŒìŠ¤íŠ¸:');
            
            // 1. í™˜ê²½ë³€ìˆ˜ í™•ì¸
            console.log('1ï¸âƒ£ í™˜ê²½ë³€ìˆ˜:', window.ENV);
            
            // 2. Kakao Maps í™•ì¸
            console.log('2ï¸âƒ£ Kakao Maps:', typeof kakao !== 'undefined' ? 'âœ… ë¡œë“œë¨' : 'âŒ ì—†ìŒ');
            
            // 3. Supabase í™•ì¸
            console.log('3ï¸âƒ£ Supabase:', typeof supabase !== 'undefined' ? 'âœ… ë¡œë“œë¨' : 'âŒ ì—†ìŒ');
            
            // 4. ë°ì´í„° í™•ì¸
            const data = await testWaterStations();
            console.log('4ï¸âƒ£ ë°ì´í„°:', data ? `âœ… ${data.length}ê°œ` : 'âŒ ì—†ìŒ');
            
            // 5. ì•± ì¸ìŠ¤í„´ìŠ¤ í™•ì¸
            console.log('5ï¸âƒ£ App ì¸ìŠ¤í„´ìŠ¤:', window.app ? 'âœ… ìƒì„±ë¨' : 'âŒ ì—†ìŒ');
            
            return {
                env: !!window.ENV,
                kakao: typeof kakao !== 'undefined',
                supabase: typeof supabase !== 'undefined', 
                data: !!data,
                app: !!window.app
            };
        };
        
        console.log('ï¿½ğŸ’¡ ë””ë²„ê·¸ ë„ì›€ë§:');
        console.log('- debugApp(): ì•± ìƒíƒœ í™•ì¸');
        console.log('- testWaterStations(): ë¬¼ ì œê³µ ìœ„ì¹˜ ë°ì´í„° í…ŒìŠ¤íŠ¸');
        console.log('- testAppInitialization(): ì•± ì´ˆê¸°í™” ë‹¨ê³„ë³„ í…ŒìŠ¤íŠ¸');
    </script>
    
    <!-- JavaScript íŒŒì¼ë“¤ -->
    <script src="js/utils/config-loader.js"></script>
    <script src="js/utils/district-manager.js"></script>
    <script src="js/database/database-interface.js"></script>
    <script src="js/database/local-database.js"></script>
    <script src="js/database/supabase-database.js"></script>
    <script src="js/database/firebase-database.js"></script>
    <script src="js/database/database-factory.js"></script>
    <script src="js/services/water-station-service.js"></script>
    <script src="js/services/error-report-service.js"></script>
    <script src="js/components/error-report-ui.js"></script>
    <script src="js/components/error-report-handler.js"></script>
    <script src="js/components/map-manager.js"></script>
    <script src="js/components/ui-controller.js"></script>
    <script>
        class App {
            constructor() {
                this.configLoader = new ConfigLoader();
                this.waterStationService = null;
                this.mapManager = null;
                this.uiController = null;
            }

            async initialize() {
                try {
                    this.showLoading(true, 'ì•± ì´ˆê¸°í™” ì¤‘...');
                    console.log('ğŸš€ ì•± ì´ˆê¸°í™” ì‹œì‘...1');

                    // ì„¤ì • ë¡œë“œ
                    this.showLoading(true, 'ì„¤ì • ë¡œë“œ ì¤‘...');
                    console.log('âš™ï¸ ì„¤ì • ë¡œë“œ ì¤‘...');
                    const config = await this.configLoader.loadConfig();
                    console.log('âœ… ì„¤ì • ë¡œë“œ ì™„ë£Œ:', { hasApiKey: !!config.KAKAO_API_KEY, dbType: config.DATABASE_TYPE });

                    // API í‚¤ ê²€ì¦
                    if (!config.KAKAO_API_KEY) {
                        throw new Error('ë§µ API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜ í•´ì£¼ì„¸ìš”.');
                    }

                    // ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”
                    this.showLoading(true, 'ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì¤‘...');
                    const dbType = this.configLoader.getDatabaseType();
                    const dbConfig = this.configLoader.getDatabaseConfig();
                    
                    const database = DatabaseFactory.create(dbType, dbConfig);
                    this.waterStationService = new WaterStationService(database);
                    
                    const dbInitResult = await this.waterStationService.initialize();
                    if (!dbInitResult) {
                        throw new Error('ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }

                    // ì¹´ì¹´ì˜¤ ë§µ SDK ë¡œë“œ
                    this.showLoading(true, 'ì¹´ì¹´ì˜¤ë§µ SDK ë¡œë“œ ì¤‘...');
                    await this.loadKakaoMaps(config.KAKAO_API_KEY);

                    // ì»´í¬ë„ŒíŠ¸ ì´ˆê¸°í™”
                    this.showLoading(true, 'ì§€ë„ ë° UI ì´ˆê¸°í™” ì¤‘...');
                    
                    // ì‚¬ìš©ì ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸° ì‹œë„
                    let userLocation = null;
                    try {
                        this.showLoading(true, 'ìœ„ì¹˜ ì •ë³´ í™•ì¸ ì¤‘...');
                        userLocation = await this.getUserLocation();
                        console.log('âœ… ì‚¬ìš©ì ìœ„ì¹˜ í™•ì¸ ì™„ë£Œ:', userLocation);
                    } catch (error) {
                        console.log('âš ï¸ ìœ„ì¹˜ ì •ë³´ í™•ì¸ ì‹¤íŒ¨, ê¸°ë³¸ ìœ„ì¹˜ ì‚¬ìš©:', error.message);
                    }
                    
                    console.log('ğŸ—ºï¸ MapManager ìƒì„± ì¤‘...');
                    this.mapManager = new MapManager('map', this.waterStationService, userLocation);
                    this.uiController = new UIController(this.waterStationService, this.mapManager);

                    await this.mapManager.initialize();
                    this.uiController.initialize();

                    // í†µê³„ ì •ë³´ ì—…ë°ì´íŠ¸
                    this.showLoading(true, 'í†µê³„ ì •ë³´ ì—…ë°ì´íŠ¸ ì¤‘...');
                    console.log('ğŸ“Š í†µê³„ ì •ë³´ ì—…ë°ì´íŠ¸ ì¤‘...');
                    await this.updateStats();
                    console.log('âœ… í†µê³„ ì •ë³´ ì—…ë°ì´íŠ¸ ì™„ë£Œ');

                    this.showLoading(false);
                    console.log('ğŸ‰ ì•± ì´ˆê¸°í™” ì™„ë£Œ!');

                } catch (error) {
                    console.error('ì•± ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                    this.showLoading(false);
                    
                    // Supabaseì— ì˜¤ë¥˜ ë“±ë¡
                    await this.logErrorToSupabase(error);
                    
                    // ì‚¬ìš©ìì—ê²ŒëŠ” ê°„ë‹¨í•œ ë©”ì‹œì§€ë§Œ í‘œì‹œ
                    alert('ì•±ì„ ì´ˆê¸°í™”í•˜ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\nê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ ì£¼ì„¸ìš”.');
                    
                    // ë””ë²„ê·¸ ì •ë³´ëŠ” ì œê±° (ìƒì„¸ ì •ë³´ëŠ” DBì—ë§Œ ì €ì¥)
                    console.error('ì•± ì´ˆê¸°í™” ì‹¤íŒ¨ - ìƒì„¸ ì •ë³´ëŠ” DBì— ì €ì¥ë¨:', error.message);
                }
            }

            async loadKakaoMaps(apiKey) {
                return new Promise(async (resolve, reject) => {
                    try {
                        // API í‚¤ ìœ íš¨ì„± ê²€ì¦
                        if (!apiKey || apiKey === 'YOUR_ACTUAL_API_KEY_HERE' || apiKey.length < 10) {
                            const error = new Error('ìœ íš¨í•˜ì§€ ì•Šì€ ì¹´ì¹´ì˜¤ë§µ API í‚¤ì…ë‹ˆë‹¤. config-loader.jsì—ì„œ API í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
                            await this.logErrorToSupabase(error);
                            reject(error);
                            return;
                        }

                        // ì´ë¯¸ ë¡œë“œëœ ê²½ìš° ì²˜ë¦¬
                        if (window.kakao && window.kakao.maps) {
                            console.log('ì¹´ì¹´ì˜¤ë§µ SDKê°€ ì´ë¯¸ ë¡œë“œë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
                            resolve();
                            return;
                        }

                        console.log('ì¹´ì¹´ì˜¤ë§µ SDK ë¡œë“œ ì‹œì‘...');
                        
                        const script = document.createElement('script');
                        script.type = 'text/javascript';
                        script.src = `https://dapi.kakao.com/v2/maps/sdk.js?appkey=${apiKey}&autoload=false`;
                        
                        // íƒ€ì„ì•„ì›ƒ ì„¤ì • (10ì´ˆ)
                        const timeout = setTimeout(async () => {
                            const error = new Error('ì¹´ì¹´ì˜¤ë§µ SDK ë¡œë“œ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                            await this.logErrorToSupabase(error);
                            reject(error);
                        }, 10000);

                        script.onload = function() {
                            clearTimeout(timeout);
                            console.log('ì¹´ì¹´ì˜¤ë§µ SDK ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ');
                            
                            // kakao.maps.loadë¡œ ì‹¤ì œ ì§€ë„ API ì´ˆê¸°í™”
                            if (window.kakao && window.kakao.maps) {
                                kakao.maps.load(function() {
                                    console.log('ì¹´ì¹´ì˜¤ë§µ API ì´ˆê¸°í™” ì™„ë£Œ');
                                    resolve();
                                });
                            } else {
                                const error = new Error('ì¹´ì¹´ì˜¤ë§µ ê°ì²´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                                this.logErrorToSupabase(error);
                                reject(error);
                            }
                        };

                        script.onerror = async (error) => {
                            clearTimeout(timeout);
                            console.error('ì¹´ì¹´ì˜¤ë§µ SDK ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', error);
                            const mapError = new Error('ì¹´ì¹´ì˜¤ë§µ SDK ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. API í‚¤ë‚˜ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                            await this.logErrorToSupabase(mapError);
                            reject(mapError);
                        };

                        // DOMì— ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€
                        document.head.appendChild(script);
                    } catch (error) {
                        await this.logErrorToSupabase(error);
                        reject(error);
                    }
                });
            }

            // Supabaseì— ì˜¤ë¥˜ ë¡œê·¸ ë“±ë¡
            // ê°„ë‹¨í•œ ì˜¤ë¥˜ ë¡œê¹… (Supabase ì¤‘ë³µ ì—°ê²° ë°©ì§€)
            async logErrorToSupabase(error) {
                try {
                    console.log('ğŸ“ ì‹œìŠ¤í…œ ì˜¤ë¥˜ ë¡œê¹…:', error.message);
                    
                    // ê°„ë‹¨í•˜ê²Œ ì½˜ì†”ê³¼ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ë§Œ ê¸°ë¡ (Supabase ì¤‘ë³µ ì—°ê²° ë°©ì§€)
                    const errorData = {
                        timestamp: new Date().toISOString(),
                        message: error.message,
                        stack: error.stack?.substring(0, 200),
                        userAgent: navigator.userAgent.substring(0, 100),
                        type: this.getErrorType(error)
                    };
                    
                    // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ê°„ë‹¨íˆ ì €ì¥
                    localStorage.setItem(`app_error_${Date.now()}`, JSON.stringify(errorData));
                    
                    console.error('ì‹œìŠ¤í…œ ì˜¤ë¥˜ ì„¸ë¶€ì‚¬í•­:', errorData);
                } catch (logError) {
                    console.warn('ì˜¤ë¥˜ ë¡œê¹… ì‹¤íŒ¨:', logError);
                }
            }

            // ì˜¤ë¥˜ íƒ€ì… ë¶„ë¥˜
            getErrorType(error) {
                const message = error.message.toLowerCase();
                
                if (message.includes('api í‚¤') || message.includes('api key')) {
                    return 'APIí‚¤ì˜¤ë¥˜';
                } else if (message.includes('ë„¤íŠ¸ì›Œí¬') || message.includes('network') || message.includes('ë¡œë“œ')) {
                    return 'ë„¤íŠ¸ì›Œí¬ì˜¤ë¥˜';
                } else if (message.includes('ë°ì´í„°ë² ì´ìŠ¤') || message.includes('database')) {
                    return 'ë°ì´í„°ë² ì´ìŠ¤ì˜¤ë¥˜';
                } else if (message.includes('ì¹´ì¹´ì˜¤ë§µ') || message.includes('kakao')) {
                    return 'ì¹´ì¹´ì˜¤ë§µì˜¤ë¥˜';
                } else {
                    return 'ì‹œìŠ¤í…œì˜¤ë¥˜';
                }
            }

            showLoading(show, status = '') {
                const loadingEl = document.getElementById('loading');
                const statusEl = document.getElementById('loadingStatus');
                
                if (loadingEl) {
                    loadingEl.style.display = show ? 'block' : 'none';
                }
                
                if (statusEl && status) {
                    statusEl.textContent = status;
                }
            }

            showDebugInfo(message) {
                const debugEl = document.getElementById('debug-info');
                const contentEl = document.getElementById('debug-content');
                
                if (debugEl && contentEl) {
                    contentEl.innerHTML = message.replace(/\n/g, '<br>');
                    debugEl.style.display = 'block';
                }
            }

            async updateStats() {
                try {
                    const allStations = await this.waterStationService.getAllStations();
                    const operatingCount = allStations.filter(s => s.status === 'ìš´ì˜ì¤‘').length;
                    
                    const totalCountEl = document.getElementById('totalCount');
                    const operatingCountEl = document.getElementById('operatingCount');
                    const statsEl = document.getElementById('stats');
                    
                    if (totalCountEl) totalCountEl.textContent = `ì „ì²´: ${allStations.length}ê°œ`;
                    if (operatingCountEl) operatingCountEl.textContent = `ìš´ì˜ì¤‘: ${operatingCount}ê°œ`;
                    if (statsEl) statsEl.style.display = 'block';
                } catch (error) {
                    console.error('í†µê³„ ì •ë³´ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                }
            }

            getUserLocation() {
                return new Promise((resolve, reject) => {
                    if (!navigator.geolocation) {
                        reject(new Error('ìœ„ì¹˜ ì„œë¹„ìŠ¤ê°€ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'));
                        return;
                    }

                    // 5ì´ˆ íƒ€ì„ì•„ì›ƒ ì„¤ì •
                    const timeoutId = setTimeout(() => {
                        reject(new Error('ìœ„ì¹˜ ì •ë³´ ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.'));
                    }, 5000);

                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            clearTimeout(timeoutId);
                            resolve({
                                lat: position.coords.latitude,
                                lng: position.coords.longitude
                            });
                        },
                        (error) => {
                            clearTimeout(timeoutId);
                            let errorMessage = 'ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                            
                            switch(error.code) {
                                case error.PERMISSION_DENIED:
                                    errorMessage = 'ìœ„ì¹˜ ì•¡ì„¸ìŠ¤ê°€ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.';
                                    break;
                                case error.POSITION_UNAVAILABLE:
                                    errorMessage = 'ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                                    break;
                                case error.TIMEOUT:
                                    errorMessage = 'ìœ„ì¹˜ ì •ë³´ ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.';
                                    break;
                            }
                            
                            reject(new Error(errorMessage));
                        },
                        {
                            enableHighAccuracy: true,
                            timeout: 4000,
                            maximumAge: 60000 // 1ë¶„ê°„ ìºì‹œëœ ìœ„ì¹˜ ì‚¬ìš© ê°€ëŠ¥
                        }
                    );
                });
            }
        }

        // ë””ë²„ê¹… í•¨ìˆ˜ë“¤
        window.testDataLoad = async function() {
            console.log('ğŸ§ª ìˆ˜ë™ ë°ì´í„° ë¡œë“œ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            try {
                console.log('1ï¸âƒ£ fetchë¡œ ì§ì ‘ ë°ì´í„° ë¡œë“œ ì‹œë„...');
                const response = await fetch('./data/water_stations.json');
                console.log('ğŸ“¡ fetch ì‘ë‹µ:', response.status, response.statusText);
                
                if (!response.ok) {
                    throw new Error(`HTTP ì˜¤ë¥˜: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('âœ… ì§ì ‘ ë¡œë“œ ì„±ê³µ:', data.length, 'ê°œ ë ˆì½”ë“œ');
                console.log('ğŸ” ì²« ë²ˆì§¸ ë ˆì½”ë“œ:', data[0]);
                
                return data;
            } catch (error) {
                console.error('âŒ ì§ì ‘ ë¡œë“œ ì‹¤íŒ¨:', error);
                return null;
            }
        };
        
        window.testDatabase = async function() {
            console.log('ğŸ§ª ë°ì´í„°ë² ì´ìŠ¤ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            if (!window.app || !window.app.waterStationService) {
                console.error('âŒ ì•±ì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }
            
            try {
                console.log('2ï¸âƒ£ WaterStationServiceë¥¼ í†µí•œ ë°ì´í„° ë¡œë“œ...');
                const stations = await window.app.waterStationService.getAllStations();
                console.log('âœ… ì„œë¹„ìŠ¤ ë¡œë“œ ì„±ê³µ:', stations.length, 'ê°œ ë ˆì½”ë“œ');
                
                if (stations.length > 0) {
                    console.log('ğŸ” ì²« ë²ˆì§¸ ìŠ¤í…Œì´ì…˜:', stations[0]);
                } else {
                    console.warn('âš ï¸ ì„œë¹„ìŠ¤ì—ì„œ ë¹ˆ ë°°ì—´ ë°˜í™˜ë¨');
                }
                
                return stations;
            } catch (error) {
                console.error('âŒ ì„œë¹„ìŠ¤ ë¡œë“œ ì‹¤íŒ¨:', error);
                return null;
            }
        };

        // ì•± ì‹œì‘
        document.addEventListener('DOMContentLoaded', () => {
            const app = new App();
            window.app = app; // ì „ì—­ ì°¸ì¡° ì¶”ê°€ (ë””ë²„ê¹…ìš©)
            app.initialize();
        });
    </script>
</body>
</html>
